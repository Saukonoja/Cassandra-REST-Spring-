package rest;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import com.datastax.driver.core.Cluster;
import com.datastax.driver.core.ResultSet;
import com.datastax.driver.core.Row;


@RestController
public class DataLocationController {

    @RequestMapping("/signals")
    public Datalocation json(@RequestParam(value="block_id", defaultValue="cfd66ccc-d857-4e90-b1e5-df98a3d40cd6") String block_id) {
        CassieConnector cc = new CassieConnector();
	ResultSet result;
        result = cc.selectCassie("SELECT * FROM sonera");


        
	Row row = result.one();
        return new Datalocation(row.getUUID("block_id"),
				row.getTimestamp("insertion_time"),
				row.getDouble("lat"),
				row.getDouble("lon"),
				row.getInt("gsm"),
				row.getInt("cdma"),
				row.getInt("evdo"),
				row.getInt("lts"));
    }

    @RequestMapping("/sonera")
    public DataLocationList getSonera(){
        DataLocationList sonera = new ProviderDataList();
	CassieConnector cc = new CassieConnector();
	ResultSet result;
        result = cc.selectCassie("SELECT * FROM sonera");

	for (Row row : result) {
                DataLocation pd = new DataLocation(row.getUUID("block_id"),
                                row.getTimestamp("insertion_time"),
                                row.getDouble("lat"),
                                row.getDouble("lon"),
                                row.getInt("gsm"),
                                row.getInt("cdma"),
                                row.getInt("evdo"),
                                row.getInt("lts"));
                sonera.getSonera().add(pd);
        }
        return sonera;

    }

    @RequestMapping(value = "/sonera", method = RequestMethod.POST)
    public void postData(@RequestBody DataLocation pd){
	UUID uuid = randomUUID();
        Date date = new Date();
        //ProviderData pd = new ProviderData(uuid, date, 62.241208, 25.758931, 89, 90, 91, 92);
	CassieConnector cc = new CassieConnector();
	cc.insertCassie("sonera", pd.getBlock_id(), pd.getLat(), pd.getLon(), pd.getGsm(), pd.getCdma(), 		pd.getEvdo(), pd.getLts());
    }


}












